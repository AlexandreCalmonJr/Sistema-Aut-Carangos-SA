{% extends "base.html" %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <h1>Módulo Operacional</h1>
    <a href="{{ url_for('dashboard') }}" class="btn btn-secondary" style="width: auto;">Voltar</a>
</div>

<div class="dashboard-grid-split">
    <!-- Form -->
    <div class="glass-panel" style="padding: 1.5rem;">
        <h3>Registrar Produção</h3>
        <form method="POST">
            <div class="form-group">
                <label>Dia da Semana</label>
                <select name="dia" class="form-control">
                    <option value="Segunda">Segunda</option>
                    <option value="Terça">Terça</option>
                    <option value="Quarta">Quarta</option>
                    <option value="Quinta">Quinta</option>
                    <option value="Sexta">Sexta</option>
                    <option value="Sábado">Sábado</option>
                    <option value="Domingo">Domingo</option>
                </select>
            </div>
            <div class="form-group">
                <label>Turno</label>
                <select name="turno" class="form-control">
                    <option value="Manhã">Manhã</option>
                    <option value="Tarde">Tarde</option>
                    <option value="Noite">Noite</option>
                </select>
            </div>
            <div class="form-group">
                <label>Quantidade</label>
                <input type="number" name="quantidade" class="form-control" required min="0">
            </div>
            <button type="submit" class="btn btn-primary">Registrar</button>
        </form>
    </div>

    <!-- Report -->
    <div class="glass-panel" style="padding: 1.5rem;">
        <h3>Relatório de Produção</h3>
        <div
            style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1.5rem; text-align: center;">
            <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px;">
                <small>Total Semanal</small>
                <div style="font-size: 1.5rem; font-weight: bold; color: var(--accent-color);">{{ total_semanal }}</div>
            </div>
            <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px;">
                <small>Média Diária</small>
                <div style="font-size: 1.5rem; font-weight: bold;">{{ "%.1f"|format(media_diaria) }}</div>
            </div>
            <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px;">
                <small>Projeção Mensal</small>
                <div style="font-size: 1.5rem; font-weight: bold;">{{ mensal_est }}</div>
            </div>
        </div>

        <h4>Por Turno</h4>
        <ul style="list-style: none; margin-bottom: 1.5rem;">
            {% for turno, qtd in total_turnos.items() %}
            <li
                style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--glass-border);">
                <span>{{ turno }}</span>
                <span>{{ qtd }} un.</span>
            </li>
            {% endfor %}
        </ul>

        <h4>Comparativo Ideal (Capacidade 100%)</h4>
        <div style="margin-top: 0.5rem;">
            <table style="width: 100%; border-collapse: collapse; margin-bottom: 1rem;">
                <thead>
                    <tr style="text-align: left; border-bottom: 1px solid var(--glass-border);">
                        <th style="padding: 0.5rem;">Período</th>
                        <th style="padding: 0.5rem;">Ideal</th>
                        <th style="padding: 0.5rem;">Real</th>
                        <th style="padding: 0.5rem;">Diferença</th>
                    </tr>
                </thead>
                <tbody>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                        <td style="padding: 0.5rem;">Semanal</td>
                        <td style="padding: 0.5rem;">{{ "%.0f"|format(ideal['semanal']) }}</td>
                        <td style="padding: 0.5rem;">{{ total_semanal }}</td>
                        <td
                            style="padding: 0.5rem; color: {{ 'var(--danger)' if (total_semanal - ideal['semanal']) < 0 else 'var(--success)' }};">
                            {{ "%.0f"|format(total_semanal - ideal['semanal']) }}
                        </td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                        <td style="padding: 0.5rem;">Mensal (Est.)</td>
                        <td style="padding: 0.5rem;">{{ "%.0f"|format(ideal['mensal']) }}</td>
                        <td style="padding: 0.5rem;">{{ mensal_est }}</td>
                        <td
                            style="padding: 0.5rem; color: {{ 'var(--danger)' if (mensal_est - ideal['mensal']) < 0 else 'var(--success)' }};">
                            {{ "%.0f"|format(mensal_est - ideal['mensal']) }}
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 0.5rem;">Anual (Est.)</td>
                        <td style="padding: 0.5rem;">{{ "%.0f"|format(ideal['anual']) }}</td>
                        <td style="padding: 0.5rem;">{{ anual_est }}</td>
                        <td
                            style="padding: 0.5rem; color: {{ 'var(--danger)' if (anual_est - ideal['anual']) < 0 else 'var(--success)' }};">
                            {{ "%.0f"|format(anual_est - ideal['anual']) }}
                        </td>
                    </tr>
                </tbody>
            </table>

            <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                <span>Progresso da Meta Semanal:</span>
                <span style="color: var(--success);">{{ "%.1f"|format((total_semanal / ideal['semanal'] * 100) if
                    ideal['semanal'] > 0 else 0) }}%</span>
            </div>
            <div
                style="width: 100%; background: rgba(255,255,255,0.1); height: 8px; border-radius: 4px; overflow: hidden;">
                <div
                    style="height: 100%; background: var(--success); width: {{ (total_semanal / ideal['semanal'] * 100) if ideal['semanal'] > 0 else 0 }}%;">
                </div>
            </div>
        </div>
    </div>
</div>

<div class="glass-panel" style="margin-top: 2rem; padding: 1.5rem;">
    <h3>Histórico de Lançamentos</h3>
    <table style="width: 100%; border-collapse: collapse; margin-top: 1rem;">
        <thead>
            <tr style="text-align: left; border-bottom: 1px solid var(--glass-border);">
                <th style="padding: 0.5rem;">Dia</th>
                <th style="padding: 0.5rem;">Turno</th>
                <th style="padding: 0.5rem;">Quantidade</th>
            </tr>
        </thead>
        <tbody>
            {% for item in producao %}
            <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                <td style="padding: 0.5rem;">{{ item['dia'] }}</td>
                <td style="padding: 0.5rem;">{{ item['turno'] }}</td>
                <td style="padding: 0.5rem;">{{ item['quantidade'] }}</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="3" style="padding: 1rem; text-align: center; color: var(--secondary-color);">Nenhum
                    registro encontrado.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}